#=================================================
# Description: Build OpenWrt using GitHub Actions
# Lisence: MIT
#=================================================

name: test

on:
    push:
     branches:
      - master
#    paths:
#      - '.config'
#  schedule:
#    - cron: 15 17 * * *
#  watch:
#    types: started

env:
  REPO_URL: https://github.com/coolsnowwolf/lede
  REPO_BRANCH: master
  CONFIG_FILE: x86.config
  DIY_SH: x86_diy.sh
  SSH_ACTIONS: false
  UPLOAD_BIN_DIR: false
  UPLOAD_FIRMWARE: true
  TZ: Asia/Shanghai

jobs:
  build:
    runs-on: ubuntu-latest
    if: github.event.repository.owner.id == github.event.sender.id

    steps:
    - name: Checkout
      uses: actions/checkout@master


          
#    - name: Upload Release Asset
#      uses: svenstaro/upload-release-action@v1-release
#      with:
#        repo_token: ${{ secrets.RELEASES_TOKEN }}
#        file: ${{ env.FIRMWARE }}/*combined-squashfs.img.gz
#        #tag_name: x64精简版
#        tag: ${{ github.ref }}
#        overwrite: true
#        file_glob: true 
        
    - name: Create release
      id: create_release
      uses: ncipollo/release-action@v1.6.1
      with:
        name: ${{ github.ref }}  | 测试 test
        allowUpdates: true
        tag: ${{ github.ref }}
        commit: master
        token: ${{ secrets.RELEASES_TOKEN }}
        body: |
          Openwrt release 测试
#          ${{ env.useVersionInfo }}
#        artifacts: ${{ env.FIRMWARE }}/*

#    - name: Upload Release Asset
#      id: upload-release-asset
#      uses: actions/upload-release-asset@v1
#      env:
#        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 
#      with:
#          upload_url: ${{ steps.create_release.outputs.upload_url }}
#          asset_path: ${{ env.FIRMWARE }}/openwrt-x86-64-combined-squashfs.img.gz
#          asset_name: ${{ steps.organize.outputs.Release_tag }}-combined-squashfs.img.gz
#          asset_content_type: application/gzip
